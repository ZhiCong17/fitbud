<div class='row justify-content-center'>
  <div class='card col-10 py-4 mb-2'>
    Hi
    <%= current_user.username %>
  </div>

  <div class='card col-10 py-4 mb-2'>
    <%#= link_to(plan_path(current_user.current_plan),{class: 'text-decoration-none'}) do  %>

    <%= link_to(plan_path(current_user.current_plan),{class: 'text-decoration-none'}) do  %>
      <span>Current Plan Progress</span>
      <div class="progress my-3" role="progressbar" aria-label="Example with label" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
      <div class="progress-bar progress-bar-striped" style="width: <%=current_user.current_plan.progress_status%>%"><%= current_user.current_plan.progress_status.round(2) %>%</div>
      </div>
      <%# <%= current_user.current_plan.progress %>
    <% end %>
  </div>

  <%# plan = current_user.current_plan %>
  <%# exercise_plans = ExercisePlan.where(plan: plan) %>

  <div class='card col-10 py-4 mb-2'>
    <span class='mb-2 '>
      Display next 3 days exercise plan
    </span>
    <% exercise_plan_by_day = current_user.current_plan.exercise_plans.group_by(&:suggested_day) %>
    <% order = 1 %>
      <% exercise_plan_by_day.each do | days, exercise_plan | %>
      <% statuses = exercise_plan.map { |plan| plan.status } %>
      <% if  order <= 3 %>
        <% current_user.current_plan.update!(current_day: days) if order ==1 %>
        <% if statuses.include?(nil) %>
            <% if current_user.current_plan.current_day == days %>
              <div class="card p-2 mb-2">
                Day <%= days %>:
                <%= exercise_plan.first["description"]%>
              </div>
              <% order += 1 %>
            <%# <% raise %>
            <% else %>
                <div class="card p-2 mb-2 locked">
                <strong>üîê Please complete Day <%= current_user.current_plan.current_day %> exercise first!!!</strong>
                Day <%= days %>:
                <%= exercise_plan.first["description"]%>
              </div>
              <% order += 1 %>
            <% end %>
        <% end %>
      <% else %>
        <% break %>
      <% end %>
      <% end %>
  </div>
</div>
